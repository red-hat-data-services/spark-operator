# Docling-Spark Application for OpenShift (PVC-based Storage)

apiVersion: "sparkoperator.k8s.io/v1beta2"
kind: SparkApplication
metadata:
  name: docling-spark-job
  namespace: docling-spark
spec:
  type: Python
  pythonVersion: "3"
  mode: cluster
  image: quay.io/rishasin/docling-spark:multi-output
  imagePullPolicy: Always
  timeToLiveSeconds: 60  # Pod cleanup delay (results persist on PVC)
  mainApplicationFile: local:///app/scripts/run_spark_job.py
  arguments:
    - "--input-dir"
    - "/app/assets"
    - "--output-dir"
    - "/app/output"
  sparkVersion: "3.5.7"
  restartPolicy:
    type: Never

  # ===============================================
  # VOLUMES: PVC-based storage for input and output
  # ===============================================
  volumes:
    - name: input-data
      persistentVolumeClaim:
        claimName: docling-input
    - name: output-data
      persistentVolumeClaim:
        claimName: docling-output

  driver:
    cores: 1
    coreLimit: "1200m"
    memory: "4g"
    labels:
      version: 3.5.7
    serviceAccount: spark-driver
    securityContext: {}
    volumeMounts:
      - name: input-data
        mountPath: /app/assets
        readOnly: true
      - name: output-data
        mountPath: /app/output

  executor:
    cores: 1
    instances: 2
    memory: "4g"
    labels:
      version: 3.5.7
    securityContext: {}
    volumeMounts:
      - name: input-data
        mountPath: /app/assets
        readOnly: true
